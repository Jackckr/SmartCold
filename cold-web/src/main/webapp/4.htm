<!DOCTYPE html>
<html>
<head>
<head>
<meta charset="utf-8">
<meta http-equiv=”X-UA-Compatible” content=”IE=Edge,chrome=1″>
<meta name="renderer" content="webkit|ie-stand" />
<meta name="renderer" content="webkit">
<title>冷库360-冷库能效在线管理系统</title>
<meta charset="utf-8" name="keywords" content="冷库360,冷库监控,冷库智能管理,冷库能效评估，冷库认证与能耗管理" />
<meta charset="utf-8" name="description" content="冷库360-冷库能效在线管理系统" />
<!-- Tell the browser to be responsive to screen width -->
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
<style type="text/css">
/* #logtext{height: 100%;width:50%;} */


.logtext {
width: 100%;
background: black;
color: white;
}
#dtid_ap2 input{
width: auto;
max-width: 50%;
}

</style>
</head>
<body>
   <div id="dtid_ap1" style="width: 80%;display: block;    float: left;">
	   <textarea id="logtext" class="logtext"></textarea>
   </div>
    <div id="dtid_ap2" style="float: right;display: block;border: 1px solid #cccccc;    width: 19%;">
			    <div style="border: 1px solid #cccccc;">
			     <p>apid：<input id="txt_apid" value="4000002"></p>                        
				  <p>                          频率：<input id="txt_pl">        </p> 
				  <p>       key：<input   id  ="txt_key" value="MTD-10 5M10bS">                      </p> 
				  <p>       val：<input   id  ="txt_val" value="-20.22">                      </p> 
				  <p>       <button onclick="setConfig()">回写</button><button onclick=" $('#logtext').val('')">清屏</button>    </p> 
			    </div>
                <div>
			        <textarea id="updateLog" class="logtext" style="margin: 0px;  height: 500px;"></textarea>
               </div>
      </div><!--  -->
   <div id="dtid_ap3"></div>
</body>
<script src="assets/plugins/jQuery/jQuery-2.1.4.min.js"></script>
<script type="text/javascript">



function  Format(fmt) { //author: meizz 
    var o = {
        "M+": this.getMonth() + 1, //月份 
        "d+": this.getDate(), //日 
        "h+": this.getHours(), //小时 
        "m+": this.getMinutes(), //分 
        "s+": this.getSeconds(), //秒 
        "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
        "S": this.getMilliseconds() //毫秒 
    };
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o)
    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
    return fmt;
}

var pl=30,p4=200,iswert=false,isupdate=false,update=undefined,
qt3={"apID":"4000002","infos":[{"tagname":"MTD-10 5M10bS","currentvalue":"0","lasttime":"2017-06-02 09:52:21"},{"tagname":"MTD-10 5M10bT","currentvalue":"12.8","lasttime":"2017-06-02 09:52:21"},{"tagname":"MTD-10 5M10cS","currentvalue":"0","lasttime":"2017-06-02 09:52:22"},{"tagname":"MTD-10 5M10cT","currentvalue":"7.6","lasttime":"2017-06-02 09:52:22"},{"tagname":"MTD-11 DM11S","currentvalue":"0","lasttime":"2017-06-02 09:52:22"},{"tagname":"MTD-11 DM11T","currentvalue":"6.9","lasttime":"2017-06-02 09:52:22"},{"tagname":"MTD-12 5M12aS","currentvalue":"0","lasttime":"2017-06-02 09:52:22"},{"tagname":"MTD-12 5M12aT","currentvalue":"3.1","lasttime":"2017-06-02 09:52:22"},{"tagname":"MTD-12 5M12bS","currentvalue":"11","lasttime":"2017-06-02 09:52:22"},{"tagname":"MTD-12 5M12bT","currentvalue":"3.0","lasttime":"2017-06-02 09:52:22"},{"tagname":"MTD-13 5M13aS","currentvalue":"0","lasttime":"2017-06-02 09:52:23"},{"tagname":"MTD-13 5M13aT","currentvalue":"6.8","lasttime":"2017-06-02 09:52:23"},{"tagname":"MTD-13 5M13bS","currentvalue":"11","lasttime":"2017-06-02 09:52:23"},{"tagname":"MTD-13 5M13bT","currentvalue":"6.5","lasttime":"2017-06-02 09:52:23"},{"tagname":"压缩机 AL1","currentvalue":"1","lasttime":"2017-06-02 09:52:27"},{"tagname":"压缩机 AL2","currentvalue":"1","lasttime":"2017-06-02 09:52:27"},{"tagname":"压缩机 AL3","currentvalue":"1","lasttime":"2017-06-02 09:52:27"},{"tagname":"压缩机 AL4","currentvalue":"1","lasttime":"2017-06-02 09:52:27"},{"tagname":"冷凝器风机 A1","currentvalue":"1","lasttime":"2017-06-02 09:52:28"},{"tagname":"冷凝器风机 A2","currentvalue":"1","lasttime":"2017-06-02 09:52:28"},{"tagname":"冷凝器风机 A3","currentvalue":"1","lasttime":"2017-06-02 09:52:28"},{"tagname":"冷凝器风机 A4","currentvalue":"1","lasttime":"2017-06-02 09:52:28"},{"tagname":"冷凝器风机 A5","currentvalue":"1","lasttime":"2017-06-02 09:52:28"},{"tagname":"缺相警报 A","currentvalue":"0","lasttime":"2017-06-02 09:52:05"},{"tagname":"液位 A","currentvalue":"0","lasttime":"2017-06-02 09:52:05"},{"tagname":"缺相警报 B","currentvalue":"0","lasttime":"2017-06-02 09:52:05"},{"tagname":"液位 B","currentvalue":"0","lasttime":"2017-06-02 09:52:05"},{"tagname":"缺相警报 C","currentvalue":"0","lasttime":"2017-06-02 09:52:05"},{"tagname":"液位 C","currentvalue":"0","lasttime":"2017-06-02 09:52:06"},{"tagname":"缺相警报 D","currentvalue":"0","lasttime":"2017-06-02 09:52:06"},{"tagname":"液位 D","currentvalue":"0","lasttime":"2017-06-02 09:52:06"},{"tagname":"压缩机 BM1","currentvalue":"1","lasttime":"2017-06-02 09:52:07"},{"tagname":"压缩机 BM2","currentvalue":"1","lasttime":"2017-06-02 09:52:07"},{"tagname":"压缩机 BM3","currentvalue":"1","lasttime":"2017-06-02 09:52:07"},{"tagname":"压缩机 BM4","currentvalue":"1","lasttime":"2017-06-02 09:52:07"},{"tagname":"冷凝器风机 B1","currentvalue":"1","lasttime":"2017-06-02 09:52:07"},{"tagname":"冷凝器风机 B2","currentvalue":"0","lasttime":"2017-06-02 09:52:07"},{"tagname":"冷凝器风机 B3","currentvalue":"0","lasttime":"2017-06-02 09:52:07"},{"tagname":"冷凝器风机 B4","currentvalue":"0","lasttime":"2017-06-02 09:52:07"},{"tagname":"压缩机 CM1","currentvalue":"1","lasttime":"2017-06-02 09:52:07"},{"tagname":"压缩机 CM2","currentvalue":"0","lasttime":"2017-06-02 09:52:07"},{"tagname":"排气压力 B","currentvalue":"9.9","lasttime":"2017-06-02 09:52:31"},{"tagname":"吸气压力 BM","currentvalue":"0.3","lasttime":"2017-06-02 09:52:31"},{"tagname":"吸气温度 BM","currentvalue":"22.9","lasttime":"2017-06-02 09:52:31"},{"tagname":"排气温度 BM1","currentvalue":"96.6","lasttime":"2017-06-02 09:52:31"},{"tagname":"压缩机 CM3","currentvalue":"1","lasttime":"2017-06-02 09:52:29"},{"tagname":"冷凝器风机 C1","currentvalue":"1","lasttime":"2017-06-02 09:52:29"},{"tagname":"冷凝器风机 C2","currentvalue":"0","lasttime":"2017-06-02 09:52:29"},{"tagname":"排气温度 AL1","currentvalue":"60.1","lasttime":"2017-06-02 09:52:30"},{"tagname":"排气温度 AL2","currentvalue":"72.1","lasttime":"2017-06-02 09:52:30"},{"tagname":"排气温度 AL3","currentvalue":"69.0","lasttime":"2017-06-02 09:52:30"},{"tagname":"排气温度 AL4","currentvalue":"68.8","lasttime":"2017-06-02 09:52:30"},{"tagname":"出液温度 A","currentvalue":"32.3","lasttime":"2017-06-02 09:52:30"},{"tagname":"室内温度","currentvalue":"35.4","lasttime":"2017-06-02 09:52:29"},{"tagname":"室外温度","currentvalue":"30.3","lasttime":"2017-06-02 09:52:29"},{"tagname":"排气压力 A","currentvalue":"14.9","lasttime":"2017-06-02 09:52:29"},{"tagname":"吸气压力 AL","currentvalue":"0.9","lasttime":"2017-06-02 09:52:29"},{"tagname":"吸气温度 AL","currentvalue":"1.3","lasttime":"2017-06-02 09:52:29"},{"tagname":"MTD-14 5M14aS","currentvalue":"0","lasttime":"2017-06-02 09:52:24"},{"tagname":"MTD-14 5M14aT","currentvalue":"18.6","lasttime":"2017-06-02 09:52:24"},{"tagname":"MTD-14 5M14bS","currentvalue":"14","lasttime":"2017-06-02 09:52:24"},{"tagname":"MTD-14 5M14bT","currentvalue":"19.9","lasttime":"2017-06-02 09:52:24"},{"tagname":"MTD-15 5M15aS","currentvalue":"0","lasttime":"2017-06-02 09:52:24"},{"tagname":"MTD-15 5M15aT","currentvalue":"17.2","lasttime":"2017-06-02 09:52:24"},{"tagname":"MTD-15 5M15bS","currentvalue":"0","lasttime":"2017-06-02 09:52:24"},{"tagname":"MTD-15 5M15bT","currentvalue":"17.6","lasttime":"2017-06-02 09:52:24"},{"tagname":"MTD-14 5M14cS","currentvalue":"0","lasttime":"2017-06-02 09:52:25"},{"tagname":"MTD-14 5M14cT","currentvalue":"27.0","lasttime":"2017-06-02 09:52:25"},{"tagname":"MTD-15 5M15cS","currentvalue":"0","lasttime":"2017-06-02 09:52:25"},{"tagname":"MTD-15 5M15cT","currentvalue":"15.8","lasttime":"2017-06-02 09:52:25"},{"tagname":"MTD-16 5M16aS","currentvalue":"4","lasttime":"2017-06-02 09:52:25"},{"tagname":"MTD-16 5M16aT","currentvalue":"16.4","lasttime":"2017-06-02 09:52:25"},{"tagname":"MTD-16 5M16bS","currentvalue":"4","lasttime":"2017-06-02 09:52:25"},{"tagname":"MTD-16 5M16bT","currentvalue":"18.5","lasttime":"2017-06-02 09:52:25"},{"tagname":"MTD-16 5M16cS","currentvalue":"4","lasttime":"2017-06-02 09:52:26"},{"tagname":"MTD-16 5M16cT","currentvalue":"19.6","lasttime":"2017-06-02 09:52:26"},{"tagname":"MTD-17 5M17aS","currentvalue":"0","lasttime":"2017-06-02 09:52:26"},{"tagname":"MTD-17 5M17aT","currentvalue":"12.7","lasttime":"2017-06-02 09:52:26"},{"tagname":"MTD-2 DM2S","currentvalue":"11","lasttime":"2017-06-02 09:52:27"},{"tagname":"MTD-2 DM2T","currentvalue":"2.7","lasttime":"2017-06-02 09:52:27"},{"tagname":"MTD-17 DM17S","currentvalue":"0","lasttime":"2017-06-02 09:52:27"},{"tagname":"MTD-17 DM17T","currentvalue":"12.0","lasttime":"2017-06-02 09:52:27"},{"tagname":"排气温度 BM2","currentvalue":"95.6","lasttime":"2017-06-02 09:52:31"},{"tagname":"排气温度 BM3","currentvalue":"95.1","lasttime":"2017-06-02 09:52:31"},{"tagname":"排气温度 BM4","currentvalue":"91.7","lasttime":"2017-06-02 09:52:31"},{"tagname":"出液温度 B","currentvalue":"43.3","lasttime":"2017-06-02 09:52:31"},{"tagname":"排气压力 C","currentvalue":"9.1","lasttime":"2017-06-02 09:52:31"},{"tagname":"吸气压力 CM","currentvalue":"0.4","lasttime":"2017-06-02 09:52:31"},{"tagname":"吸气温度 CM","currentvalue":"15.3","lasttime":"2017-06-02 09:52:32"},{"tagname":"排气温度 CM1","currentvalue":"93.6","lasttime":"2017-06-02 09:52:32"},{"tagname":"排气温度 CM2","currentvalue":"87.1","lasttime":"2017-06-02 09:52:32"},{"tagname":"排气温度 CM3","currentvalue":"93.3","lasttime":"2017-06-02 09:52:32"},{"tagname":"出液温度 C","currentvalue":"36.7","lasttime":"2017-06-02 09:52:32"},{"tagname":"排气压力 D","currentvalue":"8.6","lasttime":"2017-06-02 09:52:33"},{"tagname":"吸气压力 DM","currentvalue":"1.0","lasttime":"2017-06-02 09:52:33"},{"tagname":"吸气温度 DM","currentvalue":"13.5","lasttime":"2017-06-02 09:52:33"},{"tagname":"排气温度 DM1","currentvalue":"79.8","lasttime":"2017-06-02 09:52:33"},{"tagname":"排气温度 DM2","currentvalue":"55.1","lasttime":"2017-06-02 09:52:33"},{"tagname":"排气温度 DM3","currentvalue":"74.7","lasttime":"2017-06-02 09:52:34"},{"tagname":"排气温度 DM4","currentvalue":"69.1","lasttime":"2017-06-02 09:52:34"},{"tagname":"出液温度 D","currentvalue":"37.9","lasttime":"2017-06-02 09:52:34"},{"tagname":"冷凝器风机 C3","currentvalue":"0","lasttime":"2017-06-02 09:52:29"}]};
;

function timegetdata(){
	getData();
	updateLog();
}


function getData(){
   $.ajax({type : "GET",url : "i/getQTData",contentType: "application/json; charset=utf-8", data:{apid:$("#txt_apid").val()  },success : function(data) {
	   data
	   
	   Format
	   $("#logtext").val(data.message);
	   }});
}
function updateLog(){
   $.ajax({type : "GET",url : "i/getQTUPlog",contentType: "application/json; charset=utf-8", data:{apid:$("#txt_apid").val()  },success : function(data) {$("#updateLog").val(data);}});
}
function setConfig(){
	var data={apid:$("#txt_apid").val(),pl:$("#txt_pl").val(),key:$("#txt_key").val(),val:$("#txt_val").val()};
     $.ajax({type : "POST",url : "i/updateConfig",data:data ,success : function(data) {
	   if(data){
		  alert("指令已发送！等待请求更新！");
	   }
    }});
}
//==========================================================================================================================================================
function getConfig(){
     $.ajax({type : "POST",url : "i/QTDEVConfig",contentType: "application/json; charset=utf-8",data:"{'apID':'"+$("#txt_apid").val() +"'}" ,success : function(data) { 
    	   console.log("收到回写数据");
    	   $.each( data.infos, function(i, vo){
    		   $.each(  qt3.infos, function(i, vo1){
        		  if(vo.tagname==vo1.tagname){
        			  vo1.currentvalue=vo.value;
        		  }
        	   });
    		   
    	   });
    	   console.log("回写数完成！！！！！！"); 
    	   isupdate=true;
    	   update=data;
     }});
}

function senddata1(){
	if(isupdate){alert("回写成功:！:"+JSON.stringify(update));}isupdate=false;
    var data=	JSON.stringify(qt3);
	  $.ajax({type : "POST",dataType : "json",contentType: "application/json;charset=utf-8",url : "i/QTDataCollection",data :data,success : function(data) { //JSON.stringify(qt3)
		  if(data.updateConf){ 
			  console.log("服务器准备更新数据");
	          getConfig();
	  }}});
}

/**/

$().ready(function () {
	if (window.innerWidth)
		winWidth = window.innerWidth;
		else if ((document.body) && (document.body.clientWidth))
		winWidth = document.body.clientWidth;
		// 获取窗口高度
		if (window.innerHeight)
		winHeight = window.innerHeight;
		else if ((document.body) && (document.body.clientHeight))
		winHeight = document.body.clientHeight;
		// 通过深入 Document 内部对 body 进行检测，获取窗口大小
		if (document.documentElement && document.documentElement.clientHeight && document.documentElement.clientWidth)
		{
		winHeight = document.documentElement.clientHeight;
		winWidth = document.documentElement.clientWidth;
	   }
		width=winHeight-20;
		width=width>500?width:500;
	     $("#logtext").height(width);
	     window.setInterval(timegetdata,3000); 
	     window.setInterval(senddata1,pl*1000); 
	     senddata1();
	
	
});




   


</script>
</html>