<!DOCTYPE html>
<html>
<head>
<head>
<meta charset="utf-8">
<meta http-equiv=”X-UA-Compatible” content=”IE=Edge,chrome=1″>
<meta name="renderer" content="webkit|ie-stand" />
<meta name="renderer" content="webkit">
<title>冷库360-冷库能效在线管理系统</title>
<meta charset="utf-8" name="keywords" content="冷库360,冷库监控,冷库智能管理,冷库能效评估，冷库认证与能耗管理" />
<meta charset="utf-8" name="description" content="冷库360-冷库能效在线管理系统" />
<!-- Tell the browser to be responsive to screen width -->
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
<style type="text/css">
/* #logtext{height: 100%;width:50%;} */


.logtext {
width: 100%;
background: black;
color: white;
}
#dtid_ap2 input{
width: auto;
max-width: 50%;
}

</style>
</head>
<body>
   <div id="dtid_ap1" style="width: 80%;display: block;    float: left;">
	   <textarea id="logtext" class="logtext"></textarea>
   </div>
    <div id="dtid_ap2" style="float: right;display: block;border: 1px solid #cccccc;    width: 19%;">
			    <div style="border: 1px solid #cccccc;">
			     <p>apid：<input id="txt_apid" value="4000001"></p>                        
				  <p>                          频率：<input id="txt_pl">        </p> 
				  <p>       key：<input   id  ="txt_key" value="点2">                      </p> 
				  <p>       val：<input   id  ="txt_val" value="10">                      </p> 
				  <p>       <button onclick="setConfig()">回写</button><button onclick=" $('#logtext').val('')">清屏</button>    </p> 
			    </div>
                <div>
			        <textarea id="updateLog" class="logtext" style="margin: 0px;  height: 500px;"></textarea>
               </div>
      </div><!--  -->
   <div id="dtid_ap3"></div>
</body>
<script src="assets/plugins/jQuery/jQuery-2.1.4.min.js"></script>
<script type="text/javascript">

var pl=10,p4=200,iswert=false;
var qt1={apID:"4000001",time:new Date().getTime(),infos:[{tagname:"点2",value:200},{tagname:"CO2机组_低压压力",value:40}]}
, qt2="{'apID':'40000002','time':'"+new Date().getTime()+"','infos':[{'tagname':'点1','value':'10'},{'tagname':'s力','value':'40'}]}";

function timegetdata(){
	getData();
	updateLog();
}


function getData(){
   $.ajax({type : "GET",url : "i/getQTData",contentType: "application/json; charset=utf-8", data:{apid:$("#txt_apid").val()  },success : function(data) {if(data.success&&data.message!=""){$("#logtext").val($("#logtext").val()+"\r\n"+data.message);}}});
}
function updateLog(){
   $.ajax({type : "GET",url : "i/getQTUPlog",contentType: "application/json; charset=utf-8", data:{apid:$("#txt_apid").val()  },success : function(data) {$("#updateLog").val(data);}});
}
function setConfig(){
	var data={apid:$("#txt_apid").val(),pl:$("#txt_pl").val(),key:$("#txt_key").val(),val:$("#txt_val").val()};
     $.ajax({type : "POST",url : "i/updateConfig",data:data ,success : function(data) {
	   if(data){
		  alert("指令已发送！等待请求更新！");
	   }
    }});
}
//==========================================================================================================================================================
function getConfig(){
     $.ajax({type : "POST",url : "i/QTDEVConfig",contentType: "application/json; charset=utf-8",data:"{'apID':'"+$("#txt_apid").val() +"'}" ,success : function(data) { 
    	 console.log("收到回写数据");
    	   $.each( data.infos, function(i, vo){
    		   $.each(  qt1.infos, function(i, vo1){
        		  if(vo.tagname==vo1.tagname){
        			  vo1.value=vo.value;
        			  return false;
        		  }
        	   });
    		   
    	   });
    	 
     }});
}

function senddata1(){
	  $.ajax({type : "POST",dataType : "json",contentType: "application/json;charset=utf-8",url : "i/QTDataCollection",data :JSON.stringify(qt1),success : function(data) { 
		  if(data.updateConf){ 
			  console.log("服务器准备更新数据");
	          getConfig();
	  }}});
}

/**/

$().ready(function () {
	if (window.innerWidth)
		winWidth = window.innerWidth;
		else if ((document.body) && (document.body.clientWidth))
		winWidth = document.body.clientWidth;
		// 获取窗口高度
		if (window.innerHeight)
		winHeight = window.innerHeight;
		else if ((document.body) && (document.body.clientHeight))
		winHeight = document.body.clientHeight;
		// 通过深入 Document 内部对 body 进行检测，获取窗口大小
		if (document.documentElement && document.documentElement.clientHeight && document.documentElement.clientWidth)
		{
		winHeight = document.documentElement.clientHeight;
		winWidth = document.documentElement.clientWidth;
	   }
		width=winHeight-20;
		width=width>500?width:500;
	   $("#logtext").height(width);
	   

	   window.setInterval(timegetdata,3000); 
	    window.setInterval(senddata1,pl*1000); 
// 	  window.setInterval(senddata2,20000); 
	
});




   


</script>
</html>