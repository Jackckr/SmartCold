<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>冷库360-登录-冷库能效在线管理系统</title>
    <meta charset="utf-8" name="keywords" content="冷库360,冷库监控,冷库智能管理,冷库能效评估，冷库认证与能耗管理"/>
    <meta charset="utf-8" name="description" content="冷库360-冷库能效在线管理系统"/>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="shortcut icon" href="assets/img/favicon.ico"/>
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/iconfont.css">
    <style>
        .iconfont {
            font-family: iconfont !important;
            font-size: 16px;
            font-style: normal;
            -webkit-font-smoothing: antialiased;
            -webkit-text-stroke-width: .2px;
            -moz-osx-font-smoothing: grayscale
        }
.register-box-body form p{
    		color:red;
    		font-size: 12px;
    	}
        .login_new {
            background: #fff;
            font-family: "微软雅黑", Microsoft YaHei, Helvetica, '宋体', Tahoma, Arial, sans-serif
        }

        .loginDiv {
            width: 100%;
            text-align: left;
        }

        .loginBody, .loginCopyR, .loginDiv h2 {
            width: 90%;
            margin: 0 auto
        }

        .loginDiv h2 {
            height: 75px;
            line-height: 75px;
            font-family: "微软雅黑", Microsoft YaHei, Helvetica, '宋体', Tahoma, Arial, sans-serif
        }

        .loginBody {
            min-height: 500px;
            margin: 20px auto;
            background: url(assets/img/login_bg.png) no-repeat center;
            background-size: cover;
            text-align: right
        }

        .loginCopyR {
            text-align: right
        }

        .loginArea {
            display: inline-block;
            width: 325px;
            height: 500px;
            border: 1px solid #dbdbdb;
            background: rgba(255, 255, 255, .6);
            margin: 90px 10vh 0 0;
            padding: 50px 20px 0;
            box-sizing: border-box
        }

        .userinfo {
            position: relative;
            margin-bottom: 20px
        }

        .userinfo input {
            width: 100%;
            padding-left: 2em;
            border-radius: 3px;
            height: 40px;
            line-height: 40px;
            font-size: 16px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border: 1px solid #ccc;
            box-shadow: 0 2px 3px 0 rgba(0, 0, 0, .1) inset;
            -webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, .1) inset;
            -moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, .1) inset;
            -ms-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, .1) inset;
            outline: 0
        }

        .userinfo input:focus {
            border: 2px solid #428CCB
        }

        .userinfo .icon {
            position: absolute;
            top: 50%;
            left: 10px;
            font-size: 20px;
            color: #999;
            -webkit-transform: translateY(-50%);
            -moz-transform: translateY(-50%);
            -ms-transform: translateY(-50%);
            -o-transform: translateY(-50%);
            transform: translateY(-50%)
        }

        .loginArea .clearfix {
            margin: 40px 0 0
        }

        .loginArea .clearfix a {
            color: #666
        }

        .noM {
            margin: 0
        }

        .loginBtn {
            padding: 0
        }

        .loginBtn .btn {
            padding-top: 8px;
            padding-bottom: 8px;
            border-radius: 3px
        }

        @media screen and (min-width: 1367px) {
            .loginArea {
                width: 360px;
                height: 500px;
            }

            .loginArea .clearfix {
                margin: 80px 0 0
            }
        }

        .divide-wrap {
            position: relative;
            height: 1px;
            z-index: 1;
        }

        .colorbar {
            width: 100%;
            height: 100%;
            z-index: 11;
            background: url(img/com/lop.png) center no-repeat;
            position: relative;
        }
    </style>
</head>
<body class="hold-transition login-page login_new">
<!-- new login -->
<div class="loginDiv">
    <h2>冷库360在线管理系统</h2>
</div>
<div class="divide-wrap">

    <div class="colorbar"></div>
</div>
<div class="loginBody login-box">
    <div class="loginArea">
        <div class="register-box-body">
        <p class="login-box-msg">新用户注册</p>
        <form action="../../index.html" method="post">
          <div class="form-group has-feedback">
            <input id="txt_username" type="text" class="form-control" placeholder="用户名" onblur="checkUserName()">
            <span class="glyphicon glyphicon-user form-control-feedback"></span>
          </div>
          <p class="userMsg"></p>
          <div class="form-group has-feedback">
            <input id="txt_password" type="password" class="form-control" placeholder="密码" onblur="checkpwd()">
            <span class="glyphicon glyphicon-lock form-control-feedback"></span>
          </div>
          <p class="psdMsg"></p>
          <div class="form-group has-feedback">
            <input  id="txt_refpassword" type="password" class="form-control" placeholder="重输密码" onblur="checkopwd()">
            <span class="glyphicon glyphicon-log-in form-control-feedback"></span>
          </div>
          <p class="rePsdMsg"></p>
          <div class="form-group has-feedback">
            <input id="txt_telephone" type="text" class="form-control" placeholder="手机号" onblur="checktelephone()">
            <span class="glyphicon glyphicon-earphone form-control-feedback" ></span>
          </div>
          <p class="telMsg"></p>
          <div class="input-group form-group">
            <input id="txt_vicode" type="text" class="form-control" placeholder="输入验证码" onkeyup="checkcode(this)">
            <span id="sp_yzmbut" class="input-group-addon btn btn-primary" onclick="getviercode(this)">获取验证码</span>
          </div>
          <p class="codeMsg"></p>
          <div>
              <button id="submit" type="button" class="btn btn-primary btn-block btn-flat" disabled onclick="reguser()">注册</button>
          </div>
          <div class="text-right" style="margin-top: 10px;">
          	  <a href="login.html">已经注册</a>
          </div>
        </form>

        <div class="social-auth-links text-center">
        </div>

        <a href="login.html" class="text-center"></a>
      </div>
    </div>
</div>
<div id="loginCopyR" class="loginCopyR">
    <p>&copy;2016&nbsp;Smartcold&nbsp;&nbsp;&nbsp;&nbsp;沪ICP备 16004753&nbsp;&nbsp;&nbsp;&nbsp;中国物流与采购联合会冷链物流专业委员会指定在线服务平台</p>
</div>
<script src="assets/plugins/jQuery/jQuery-2.1.4.min.js"></script>
<script type="text/javascript">
var mainHeight = $(window).height();
$(".loginBody").height(mainHeight - 160);
window.onresize = function () {
    var mainHeight = $(window).height();
    $(".loginBody").height(mainHeight - 160);
};
jQuery.ajaxSetup({xhrFields:{withCredentials:true}});

function getCookie(name) 
{ 
    var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
 
    if(arr=document.cookie.match(reg))
 
        return unescape(arr[2]); 
    else 
        return null; 
} 
function delCookie(name) 
{ 
    var exp = new Date(); 
    exp.setTime(exp.getTime() - 1); 
    var cval=getCookie(name); 
    if(cval!=null) 
        document.cookie= name + "="+cval+";expires="+exp.toGMTString(); 
} 
delCookie("token");
$.ajax({type: "GET",cache: false,dataType: 'json',url: '/i/user/logout'}).success(function(data){});//清除服务器和本地缓存
var victdata={code:null,key:new Date().getDate()*2, userName:false,victpwd:false,victel:false,victyzm:false};

function checkinfo(){
	var vis=victdata.userName&&victdata.victpwd&&victdata.victel&&victdata.victyzm;
	  $("#submit").attr("disabled",!vis);
}

function vsphone(telephone) {// 验证手机号码
	var length = (telephone + '').length;
	var mobile = /^1[3|4|5|7|8][0-9]\d{4,8}$/;
	return telephone && length == 11&& mobile.test(telephone);
};

function checkUserName(){
	    var username=$("#txt_username").val().trim();
	    var reg=/^[a-zA-Z0-9][a-zA-Z0-9]{5,15}$/;
	    if(username&&username.length>5&&username.length<17&&reg.test(username)){
	        $.post('/i/user/existenceUserName',{userName:username}, function(data){
			if(data){
				victdata.userName=false;
			   $(".userMsg").html("用户名已存在<a href='login.html'>去登录</a>");
			}else{
				$(".userMsg").html("");
				victdata.userName=true;
			}
		});
	    }else{
	         victdata.userName=false;
		      $(".userMsg").html("用户名不能包含中文和特殊字符，长度在6到16位之间~");
	    }
	    checkinfo();
};

	function checkcode(em) {
		victdata.victyzm = em.value.trim().length == 4 && victdata.code == em.value.trim();
		if(victdata.victyzm){
			$(".codeMsg").html("");
		}else{
			$(".codeMsg").html("验证码有误~");
		}
		checkinfo();
	}
	function getviercode(){
	    if(!victdata.victel||!vsphone($("#txt_telephone").val())){checktelephone(); return ;}
		$.ajax({
			type : "POST",
			url : "http://liankur.com/" + '/i/user/getVerCode',
			data : {
				key : victdata.key,
				reg : window.location.pathname,
				telephone : $("#txt_telephone").val().trim()
			},
			success : function(data) {
				alert("验证码已发送~");
				victdata.code = data;
			}
		});
		};

//验证手机号码
function checktelephone(){
	var telephone = $("#txt_telephone").val().trim();
	var ct = vsphone(telephone);
    if(ct){
		 victdata.victel=true;
		 $(".telMsg").html("");
		 $('#sp_yzmbut').attr('disabled',!ct);
	}else{
		 victdata.victel=false;
		 $(".telMsg").html("手机号不正确~");
		 $('#sp_yzmbut').attr('disabled',!ct);
	}
    checkinfo();
};	

function checkpwd(){
	victdata.victpwd=false;
   var password = $("#txt_password").val().trim(); 
   if(password == ''){
		$(".psdMsg").html("密码不能为空");
	}else if(password.length<6){
		$(".psdMsg").html("密码长度最少六位");
	}else if(password.length<=16){
		$(".psdMsg").html("");
		if (/^(\d)\1+$/.test(password)){
			$(".psdMsg").html("密码太过简单了~").css("color","#f80");
		}
	}else if(password.length>16){
		$(".psdMsg").html("密码长度最多16位~").css("color","#f80");
	}else {
		$(".psdMsg").html("");
		victdata.victpwd=true;
	}
    checkinfo();
}

function checkopwd(){
	    var password=$("#txt_password").val().trim(), repsword=$("#txt_refpassword").val().trim();
		if(password != repsword){
			$(".rePsdMsg").html("两次密码输入不一致，请重新输入");
			victdata.victpwd=false;
		}else{
			$(".rePsdMsg").html("");
			victdata.victpwd=true;
		}
		checkinfo();
}

	
function reguser(){
	var inputArry = $("input[type='text']"),i=0,len = inputArry.length;
	for(i; i<len; i++){
    	if(inputArry.eq(i).val().trim()==""){
    		alert("请填写完整再注册~");
    		return
    	}
	}
	var me = "#submit"; 
	if ($(me).data("isLoading") === true) { return; }
		var userMsg = $('.userMsg').html().trim(),
			psdMsg = $('.psdMsg').html().trim(),
			rePsdMsg = $('.rePsdMsg').html().trim(),
			telMsg = $('.telMsg').html().trim(),
			codeMsg = $('.codeMsg').html().trim();
	    if(userMsg != ""){
	    	alert(userMsg);
	    }else if(psdMsg != "" || rePsdMsg != ""){
	    	alert("密码输入不符合要求，请检查~");
	    }else if(telMsg != ""){
	    	alert(telMsg);
	    }else if(codeMsg != ""){
	    	alert(codeMsg);
	    }else{
	        $(me).text("注册中...");
	        $(me).data("isLoading", true);
	    	if(victdata.userName&&victdata.victpwd&&victdata.victyzm){
		   $.ajax({
	    		type:"POST",
	    		url:"/i/user/signup",
	    		data:{  
	    				username:$("#txt_username").val().trim(),
	    				password: $("#txt_password").val().trim(),
	    				telephone: $("#txt_telephone").val().trim(),
	    				signUpCode:$("#txt_vicode").val().trim(),
	    				},
	    		  complete: function(e) {
	    	            $(me).text("注册");
	    	            $(me).delay(500).data("isLoading", false);
	    	      }
	    		}).success(function(data){
    				   if(data.success){
    					    document.cookie = data.message;
    	                    window.sessionStorage.sikey = data.message;
    	                    window.location.href  = "/autIdentity.html";
    						window.event.returnValue=false;
    				   }else{
    					   alert(dta.message);
    				   }
    		   });
		}
	    }
}

</script>
</body>
</html>
