<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>冷库360-注册-冷库能效在线管理系统</title>
	<meta charset="utf-8" name="keywords" content="冷库360,冷库监控,冷库智能管理,冷库能效评估，冷库认证与能耗管理"/>
	<meta charset="utf-8" name="description" content="冷库360-冷库能效在线管理系统"/>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="shortcut icon" href="assets/img/favicon.ico" />
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="assets/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="assets/css/AdminLTE.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="assets/plugins/iCheck/square/blue.css">

    <style type="text/css">
    	.typeCold {margin: 10px 0 20px;}
    	.typeCold .pull-left{
    		width: 25%;
    		line-height: 2;
    	}
    	.typeCold .checkbox-inline{
    		padding-left: 0;
    	}
    </style>
  </head>
  <body class="hold-transition register-page">
    <div class="register-box" style="width:400px;">
      <div class="register-logo">
        <label href=""><b>冷库360</b>SmartCold</label>
      </div>

      <div class="register-box-body">
        <p class="login-box-msg">新用户注册</p>
        <form action="../../index.html" method="post">
          <div class="form-group has-feedback">
            <input id="txt_username" type="text" class="form-control" placeholder="用户名" onblur="checkUserName()">
            <span class="glyphicon glyphicon-user form-control-feedback"></span>
          </div>
          <div class="form-group has-feedback">
            <input id="txt_password" type="password" class="form-control" placeholder="密码" onchange="checkpwd()">
            <span class="glyphicon glyphicon-lock form-control-feedback"></span>
          </div>
          <div class="form-group has-feedback">
            <input  id="txt_refpassword" type="password" class="form-control" placeholder="重输密码" onblur="checkopwd()">
            <span class="glyphicon glyphicon-log-in form-control-feedback"></span>
          </div>
          <div class="form-group has-feedback">
            <input id="txt_telephone" type="text" class="form-control" placeholder="手机号" onchange="checktelephone()">
            <span class="glyphicon glyphicon-envelope form-control-feedback" ></span>
          </div>
          <div class="input-group">
            <input id="txt_vicode" type="text" class="form-control" placeholder="输入验证码" onchange="checkcode(this)">
            <span id="sp_yzmbut" class="input-group-addon btn btn-primary" onclick="getviercode(this)">获取验证码</span>
          </div>
          <div class="clearfix typeCold">
	      	<div style="width: 100%;">
	      		<label>注册类型</label>
	      	</div>
	      	<div class="pull-left">
	  	      <label class="checkbox-inline">
	  		    <input type="radio" name="coldType" value="2">温度版
	  		  </label>
	      	</div>
			<div class="pull-left">
		      <label class="checkbox-inline">
			    <input type="radio" name="coldType" value="3">智能版
			  </label>
		  	</div>
			<div class="pull-left">
		      <label class="checkbox-inline">
			    <input type="radio" name="coldType" value="4" checked="checked">聪慧版
			  </label>
		    </div>
		    <div class="pull-left">
		      <label class="checkbox-inline">
			    <input type="radio" name="coldType" value="1">维修版
			  </label>
		 	 </div>
	    </div>
          <div>
              <button id="submit" type="button" class="btn btn-primary btn-block btn-flat" onclick="reguser()">注册</button>
          </div>
        </form>

        <div class="social-auth-links text-center">
        </div>

        <a href="login.html" class="text-center"></a>
      </div><!-- /.form-box -->
    </div><!-- /.register-box -->

    <!-- jQuery 2.1.4 -->
    <script src="assets/plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script type="text/javascript">
    jQuery.ajaxSetup({xhrFields:{withCredentials:true}});
	var victdata={code:null,key:new Date().getDate()*2,isdebugger:true, userName:false,victpwd:false,victel:false,victyzm:false};
	function vsphone(telephone) {// 验证手机号码
		var length = (telephone + '').length;
		var mobile = /^1[3|4|5|7|8][0-9]\d{4,8}$/;
		return telephone && length == 11&& mobile.test(telephone);
	};
	
	
    function checkUserName(){
   	    var username=$("#txt_username").val().trim();
   	    var reg=/^[a-zA-Z0-9][a-zA-Z0-9]{5,15}$/;
   	    if(username&&username.length>6&&username.length<24&&reg.test(username)){
   	        $.post('/i/user/existenceUserName',{userName:username}, function(data){
				if(data){ alert( "用户名已存在");}
				victdata.userName=data;
			});
   	    }else{
   	       victdata.userName=false;
//    	       $("#txt_username").focus();
   	       alert("用户名不能包含中文和特殊字符，长度在6到16位之间~");
   	    }
    };
    
    function checkcode(em){victdata.victyzm= em.value.trim().length==4&&victdata.code==em.value.trim();}
    function getviercode(){
    	    if(!victdata.victel){return ;}
    		 var url=victdata.isdebugger?"http://localhost:8080/":"http://liankur.com/"; $.ajax({ type: "POST",url:url+'/i/user/getVerCode', data:{key:victdata.key,reg:window.location.pathname,telephone:$("#txt_telephone").val().trim()}, success: function(data) {victdata.code=data; }});
    };
  
    //验证手机号码
    function checktelephone(){
		var telephone = $("#txt_telephone").val().trim();
		var ct = vsphone(telephone);
	    if(ct){
			victdata.victel=true;
			 $('#sp_yzmbut').attr('disabled',!ct);
		}else{
			 victdata.victel=false;
			 $('#sp_yzmbut').attr('disabled',!ct);
		}
	};	
	
	function checkpwd(){
		
		
	}
	
    function checkopwd(){
    	 var pwd=$("#txt_password").val().trim(), pwd1=$("#txt_refpassword").val().trim();
    	 victdata.victpwd= pwd.length>6&& pwd==pwd1;
	}

    	
    function reguser(){
    		if(!victdata.userName||!victdata.victpwd||!victdata.victyzm)
    		$.ajax({
    	    		type:"POST",
    	    		url:"/i/user/signup",
    	    		data:{  
    	    				username:$("#txt_username").val().trim(),
    	    				password: $("#txt_password").val().trim(),
    	    				telephone: $("#txt_telephone").val().trim(),
    	    				signUpCode:$("#txt_vicode").val().trim(),
    	    				type:$("input[name='coldType']:checked").val().trim(),
    	    				}
    	    		}).success(function(data){
        				   alert(data.message);
        				   if(data.success){
        						window.location.href = "http://" + window.location.host + "/login.html";
        						window.event.returnValue=false;
        				   }
        		   });
    		}

    </script>
  </body>
</html>
