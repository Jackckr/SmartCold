<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>冷库360-注册-冷库能效在线管理系统</title>
	<meta charset="utf-8" name="keywords" content="冷库360,冷库监控,冷库智能管理,冷库能效评估，冷库认证与能耗管理"/>
	<meta charset="utf-8" name="description" content="冷库360-冷库能效在线管理系统"/>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="shortcut icon" href="assets/img/favicon.ico" />
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="assets/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="assets/css/AdminLTE.min.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="assets/plugins/iCheck/square/blue.css">

    <style type="text/css">
    	.typeCold {margin: 10px 0 20px;}
    	.typeCold .pull-left{
    		width: 20%;
    		line-height: 2;
    	}
    	.typeCold .checkbox-inline{
    		padding-left: 0;
    	}
    	.register-box-body form p{
    		color:red;
    		font-size: 12px;
    	}
    </style>
  </head>
  <body class="hold-transition register-page">
    <div class="register-box" style="width:400px;">
      <div class="register-logo">
        <label href=""><b>冷库360</b>SmartCold</label>
      </div>

      <div class="register-box-body">
        <p class="login-box-msg">新用户注册</p>
        <form action="../../index.html" method="post">
          <div class="form-group has-feedback">
            <input id="txt_username" type="text" class="form-control" placeholder="用户名" onblur="checkUserName()">
            <span class="glyphicon glyphicon-user form-control-feedback"></span>
          </div>
          <p class="userMsg"></p>
          <div class="form-group has-feedback">
            <input id="txt_password" type="password" class="form-control" placeholder="密码" onchange="checkpwd()">
            <span class="glyphicon glyphicon-lock form-control-feedback"></span>
          </div>
          <p class="psdMsg"></p>
          <div class="form-group has-feedback">
            <input  id="txt_refpassword" type="password" class="form-control" placeholder="重输密码" onchange="checkopwd()">
            <span class="glyphicon glyphicon-log-in form-control-feedback"></span>
          </div>
          <p class="rePsdMsg"></p>
          <div class="form-group has-feedback">
            <input id="txt_telephone" type="text" class="form-control" placeholder="手机号" onchange="checktelephone()">
            <span class="glyphicon glyphicon-earphone form-control-feedback" ></span>
          </div>
          <p class="telMsg"></p>
          <div class="input-group form-group">
            <input id="txt_vicode" type="text" class="form-control" placeholder="输入验证码" onchange="checkcode(this)">
            <span id="sp_yzmbut" class="input-group-addon btn btn-primary" onclick="getviercode(this)">获取验证码</span>
          </div>
          <p class="codeMsg"></p>
          <div class="clearfix typeCold">
	      	<div style="width: 100%;">
	      		<label>注册类型</label>
	      	</div>
	      	<div class="pull-left">
	  	      <label class="checkbox-inline">
	  		    <input type="radio" name="coldType" value="3">温度版
	  		  </label>
	      	</div>
	      	<div class="pull-left">
	  	      <label class="checkbox-inline">
	  		    <input type="radio" name="coldType" value="4">基本版
	  		  </label>
	      	</div>
			<div class="pull-left">
		      <label class="checkbox-inline">
			    <input type="radio" name="coldType" value="5">聪慧版
			  </label>
		  	</div>
			<div class="pull-left">
		      <label class="checkbox-inline">
			    <input type="radio" name="coldType" value="6" checked="checked">智能版
			  </label>
		    </div>
		    <div class="pull-left">
		      <label class="checkbox-inline">
			    <input type="radio" name="coldType" value="2">维修版
			  </label>
		 	 </div>
	    </div>
          <div>
              <button id="submit" type="button" class="btn btn-primary btn-block btn-flat" onclick="reguser()">注册</button>
          </div>
        </form>

        <div class="social-auth-links text-center">
        </div>

        <a href="login.html" class="text-center"></a>
      </div><!-- /.form-box -->
    </div><!-- /.register-box -->

    <!-- jQuery 2.1.4 -->
    <script src="assets/plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script type="text/javascript">
    jQuery.ajaxSetup({xhrFields:{withCredentials:true}});
	var victdata={code:null,key:new Date().getDate()*2, userName:false,victpwd:false,victel:false,victyzm:false};
	function vsphone(telephone) {// 验证手机号码
		var length = (telephone + '').length;
		var mobile = /^1[3|4|5|7|8][0-9]\d{4,8}$/;
		return telephone && length == 11&& mobile.test(telephone);
	};
	
	
    function checkUserName(){
   	    var username=$("#txt_username").val().trim();
   	    var reg=/^[a-zA-Z0-9][a-zA-Z0-9]{5,15}$/;
   	    if(username&&username.length>5&&username.length<17&&reg.test(username)){
   	        $.post('/i/user/existenceUserName',{userName:username}, function(data){
				if(data){
				   $(".userMsg").html("用户名已存在")
				}else{
					$(".userMsg").html("")
				}
				victdata.userName=data;
			});
   	    }else{
   	       victdata.userName=false;
			 $(".userMsg").html("用户名不能包含中文和特殊字符，长度在6到16位之间~");
   	    }
   	    
    };
    
    	function checkcode(em) {
    		victdata.victyzm = em.value.trim().length == 4 && victdata.code == em.value.trim();
    		if(victdata.victyzm){
    			$(".codeMsg").html("");
    		}else{
    			$(".codeMsg").html("验证码有误~");
    		}
    		
    	}
    	function getviercode(){
    	    if(!victdata.victel){return ;}
    		$.ajax({
    			type : "POST",
    			url : "http://liankur.com/" + '/i/user/getVerCode',
    			data : {
    				key : victdata.key,
    				reg : window.location.pathname,
    				telephone : $("#txt_telephone").val().trim()
    			},
    			success : function(data) {
    				alert("验证码已发送~")
    				victdata.code = data;
    			}
    		});
    		};
  
    //验证手机号码
    function checktelephone(){
		var telephone = $("#txt_telephone").val().trim();
		var ct = vsphone(telephone);
	    if(ct){
			 victdata.victel=true;
			 $(".telMsg").html("");
			 $('#sp_yzmbut').attr('disabled',!ct);
			 $('#submit').attr("disabled",!ct);
		}else{
			 victdata.victel=false;
			 $(".telMsg").html("手机号不正确~");
			 $('#sp_yzmbut').attr('disabled',!ct);
			 $('#submit').attr("disabled",!ct);
		}
	};	
	
	function checkpwd(){
	   var password = $("#txt_password").val().trim(); 
       var repsword = $("#txt_refpassword").val().trim(); 
       if(password == ''){
			$(".psdMsg").html("密码不能为空");
			$('#submit').attr("disabled",true);
			return false;
		}else if(password.length<6){
			$(".psdMsg").html("密码长度最少六位");
			$('#submit').attr("disabled",true);
			return false;
		}else if(password.length<=16){
			$(".psdMsg").html("");
			if (/^(\d)\1+$/.test(password)){
				$(".psdMsg").html("密码太过简单了~").css("color","#f80");
				$('#submit').attr("disabled",true);
				return false;
			}
		}else if(password.length>16){
			$(".psdMsg").html("密码长度最多16位~").css("color","#f80");
			$('#submit').attr("disabled",true);
		}else{
			$(".psdMsg").html("输入有误，请重新输入");
		}
		
	}
	
    function checkopwd(){
    	 var password=$("#txt_password").val().trim(), repsword=$("#txt_refpassword").val().trim();
    	 if(repsword.length<6){
			$(".rePsdMsg").html("再次输入的密码长度最少六位");
			$('#submit').attr("disabled",true);
			return false;
		}else{
			if(password != repsword){
				$(".rePsdMsg").html("两次密码输入不一致，请重新输入");
				$('#submit').attr("disabled",true);
				return false;
			}else{
				$(".rePsdMsg").html("");
				$('#submit').attr("disabled",false);
			}
		}
		victdata.victpwd= password.length>6&& password==repsword;
	}

    	
    function reguser(){
    		if(!victdata.userName||!victdata.victpwd||!victdata.victyzm)
    		$.ajax({
    	    		type:"POST",
    	    		url:"/i/user/signup",
    	    		data:{  
    	    				username:$("#txt_username").val().trim(),
    	    				password: $("#txt_password").val().trim(),
    	    				telephone: $("#txt_telephone").val().trim(),
    	    				signUpCode:$("#txt_vicode").val().trim(),
    	    				type:$("input[name='coldType']:checked").val().trim(),
    	    				}
    	    		}).success(function(data){
        				   alert(data.message);
        				   if(data.success){
        						window.location.href = "http://" + window.location.host + "/notAudit.html";
        						window.event.returnValue=false;
        				   }
        		   });
    		}

    </script>
  </body>
</html>
