<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smartcold.manage.cold.dao.newdb.TempWarningMapper">
	
	
	<select id="getAllMonitorTempSet" resultType="com.smartcold.manage.cold.entity.olddb.ColdStorageSetEntity">
		 SELECT
			cs.id,
		   (SELECT group_concat(id) from smartcold.tempset  where coldStorageId=cs.id) tids,
		   (SELECT group_concat(deviceid) from deviceobjectmapping where type=18 and oid in(tids)) deviceids,
			cs.RDCID,
			cs.`name`,
			cs.`startTemperature`,
			cs.`tempdiff`
		FROM
			`smartcold`.`coldstorageset` cs 
		WHERE
			cs.`startTemperature` != 0
		AND cs.`tempdiff` != 0  ;
	</select>
	
	<select id="getMAITempData" parameterType="map" resultType="com.smartcold.manage.cold.entity.comm.ItemValue">
	     SELECT `id`,  `value` , <if test="table=='storagedatacollection'">`time`</if> `addtime`  FROM `${table}` where 
	     <if test="deviceid!=null and deviceid!=''">`deviceid` in (${deviceid}) and </if>
	     <if test="deviceid==null or deviceid==''"> `oid` in (${tids}) and </if>
	      `key` ='Temp' and `addtime` >#{starttime} and `addtime` &lt;#{endtime}
	      ORDER BY  `value`  DESC LIMIT  1;
	</select>	

	<select id="getOverStrtTime" parameterType="map" resultType="com.smartcold.manage.cold.entity.comm.ItemValue">
	     SELECT `id`, `value`  ,<if test="table=='storagedatacollection'">`time`</if> `addtime` FROM ${table} where 
	     <if test="deviceid!=null and deviceid!=''">`deviceid` in (${deviceid}) and </if>
	     <if test="deviceid==null or deviceid==''"> `oid` in (${tids}) and </if>
	      `value`>#{minTemp} and  `key` ='Temp'  and `addtime` >#{starttime} and `addtime` &lt;#{endtime}  LIMIT  1; 
	</select>	
	
	<select id="getOverTempList" parameterType="map" resultType="com.smartcold.manage.cold.entity.comm.ItemValue">
	     SELECT `id`,  `value` ,<if test="table=='storagedatacollection'">`time`</if> `addtime` FROM ${table} where 
	     <if test="deviceid!=null and deviceid!=''">`deviceid` in (${deviceid})  and </if>
	     <if test="deviceid==null or deviceid==''"> `oid` in (${tids})  and </if>
	     <if test="minTemp!=null ">  `value`>#{minTemp} and</if>
	       `key` ='Temp'  and `addtime` >#{starttime} and `addtime` &lt;#{endtime}; 
	</select>	
	
</mapper>