<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.smartcold.manage.cold.dao.olddb.MessageRecordMapping" >

    <insert id="insertMessageRecord" parameterType="MessageRecord">
        INSERT INTO `messagerecord`
        (`uid`,`rdcid`,`type`,`stype`,`title`,`message`,`addtime`)
        VALUES
        (#{uid},#{rdcId},#{type},#{sType},#{title},#{message},#{addTime})
    </insert>
   <select id="getUserAuth" parameterType="java.lang.Integer" resultType="java.lang.Integer">
     SELECT COUNT(`id`) from `messagerecord` where `type`=1 and `uid`=#{userId}  and `stype` in(1,2) and `state`=0;
   </select>
   <select id="getMsgCountByRdcId" parameterType="Integer" resultType="Integer">
     SELECT COUNT(`id`) from `messagerecord` where `rdcid`=#{rdcId}  <if test="type!=0"> and `type`!=1 </if> and `isread`=0;
   </select>
   <select id="getTallMsgByRdcId" parameterType="java.lang.Integer" resultType="MessageRecord">
     SELECT * from `messagerecord` where `rdcid`=#{rdcId} and `isread`=0 
     <if test="type!=0"> and `type`!=1 </if>
     limit 5;
   </select>
   <select id="getMsgByFilter" parameterType="Map" resultType="MessageRecord">
     SELECT * from messagerecord where  `rdcid`=#{rdcId}
      <if test="uid!=null"> and `uid`=#{uid} </if>
      <if test="type!=null"> and `type`=#{type} </if>
      <if test="stype!=null"> and `stype`=#{stype} </if>
      <if test="state!=null"> and `state`=#{state} </if>
      <if test="isread!=null"> and `isread`=#{isread} </if>
      <if test="keyword!=null and keyword!=''"> and (`title` like CONCAT('%',#{keyword},'%') or `message` like   CONCAT('%',#{keyword},'%') )   </if>
      ORDER BY addtime DESC
   </select>
   
   <update id="updateState" parameterType="map">
     update `messagerecord` set  `isread`=#{isread} , `state`=#{state} where `id`=#{id};
   </update>

</mapper>