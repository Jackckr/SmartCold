<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.smartcold.manage.cold.dao.olddb.MaintenanceMapper">

    <select id="findAllMaintenances" parameterType="map" resultType="MaintenanceEntity">
           SELECT 


id,
unitname,
reason,
detail,
note,
appraise,
audit,
date_format(ordertime,'%Y-%m-%d')ordertime,date_format(fixtime,'%Y-%m-%d') fixtime FROM `maintenance`
         <where> 
            <if test="audit != null">
			    audit=#{audit}
			</if>
		    <if test="keyword != null">
		      AND (unitname like "%"#{keyword}"%"  or note like "%"#{keyword}"%")
		    </if>
		 </where>
         order by `ordertime` desc
    </select>
    
    <insert id="insertMaintenance" parameterType="map">
      insert into `maintenance` (unitname,  reason ,  detail,   note,   appraise,   audit,   ordertime,   fixtime)
      values                 (#{unitname},#{reason},#{detail},#{note},#{appraise},#{audit},#{ordertime},#{fixtime});
    </insert>
    
    <update id="updateMaintenance" parameterType="map">
      update maintenance
        <set>
            <if test="unitname != null">
        		unitname = #{unitname,jdbcType=VARCHAR},
			</if>
			<if test="reason != null">
			  reason = #{reason,jdbcType=VARCHAR},
			</if>
			<if test="detail != null">
			  detail = #{detail,jdbcType=TIMESTAMP},
			</if>
			<if test="note != null">
			  note = #{note,jdbcType=INTEGER},
			</if>
			<if test="appraise != null">
			  appraise = #{appraise,jdbcType=REAL},
			</if>
			<if test="audit != null">
			  audit = #{audit,jdbcType=REAL},
			</if>
			<if test="ordertime != null">
			  ordertime = #{ordertime,jdbcType=VARCHAR},
			</if>
			<if test="fixtime != null">
			  fixtime = #{fixtime,jdbcType=VARCHAR},
			</if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    
    <delete id="deleteMaintenance">
		delete from maintenance where id = #{id}
	</delete>
	
	 <select id="findMaintenanceByID" parameterType="map" resultType="MaintenanceEntity">
		select * from maintenance where id = #{id}
	</select>
    
</mapper>