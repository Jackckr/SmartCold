<!DOCTYPE html>
<html>
  <head>
    <title>设备数据</title>
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8">
  </head>
  <link rel="shortcut icon" href="assets/img/favicon.ico" />
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="assets/css/index.css">
  <link rel="stylesheet" type="text/css" media="all" href="assets/jedate/skin/jedate.css" />
  <script type="text/javascript" src="assets/plugins/jQuery/jQuery-2.1.4.min.js"></script>
  <script type="text/javascript" src="bower_components/angular/angular.min.js"></script>
  <script type="text/javascript" src="assets/jedate/jquery.jedate.js"></script>
   <style>
         #deiv_ml *{margin-left: 10px;    display: inline;}
         #deiv_ml select,#deiv_ml input{height: 30px;border-radius: 5px;}
    </style>
  <body>
   <div id="div_main" ng-app="app"  ng-controller="zsdata" style="display: none">
	   <div id="dev_login" ng-if="sid==null" >
			<div class="head">
				<div class="logoArea pull-left" onclick="">
					<h1 class="logo  pull-left"></h1><h3 class="manage  pull-left">设备管理系统</h3>
				</div>
			</div>
    		<div class="content" style="background: #303A44">            
                <div class="panel panel-success">
                   <div class="panel-heading">
                      <h3 class="panel-title">设备管理员登陆</h3>
                   </div>
                   <div class="panel-body">
                      <div class="main-form-container">
                        <div class="form-group">
                            <input type="text" class="form-control" name="adminname" id="adminname" placeholder='用户名' >
                            <!-- 错误信息 popover -->
                            <div class="err-popover-out">
                                <div class="err-popover">
                                    <div class="tri-right"></div>
                                    <div class="tri-right-in"></div>
                                    <div class="err-popover-content"></div>
                                </div>
                            </div>
                            <!-- 错误信息 popover end -->
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" id="adminpwd" name="adminpwd" placeholder='密码' >
                            <!-- 错误信息 popover -->
                            <div class="err-popover-out">
                                <div class="err-popover">
                                    <div class="tri-right"></div>
                                    <div class="tri-right-in"></div>
                                    <div class="err-popover-content"></div>
                                </div>
                            </div>
                            <!-- 错误信息 popover end -->
                        </div>
                        <button type="button" id="submit" class="btn btn-form-common form-control" ng-click="login();"><span>登录</span></button>
                        <div class="row">
                          <div class="col-xs-8">
                            <a style="color:red" hidden=true id="mention">用户名或密码错误</a>
                          </div>
                        </div>
                   </div>
                </div>
    			<!-- 内容区域结构结束-->
    		</div>
	  </div>
   </div>
   <div id="dev_center"  ng-if="sid!=null" >
        <div class="text-center"><h2>设备数据查询</h2></div>
	    <div id="deiv_ml"  class="alert alert-info"  style="datatype">
	      <div >
		      <label>数据类型：</label>
		      <select id="sl_datatype" ng-model="datatype"   ng-options="obj.val as obj.text for obj in datatypeMode" ng-init="datatype='1'"></select>
	      </div>
	      <div >
		      <label >APID:</label>
		      <input >
	      </div>
	      <div ng-if="datatype!=1">
		      <label >DEVID:</label>
		      <input >
	      </div>
	      <div >
		      <label>设备类型:</label>
		       <select id="sl_timetype" ng-model="devtype" ng-options="obj.val as obj.text for obj in devtypeMode"></select>
	      </div>
	      <div >
		      <label >时间范围:</label>
		       <select id="sl_timetype" ng-model="timetype" ng-options="obj.val as obj.text for obj in timetypeMode"></select>
	      </div>
	      <div ng-if="timetype==5">
		      <label >开始时间:</label>
		     <input id="start_time" type="text" class="workinput wicon"  placeholder="请选择" readonly>
	      </div>
	      <div ng-if="timetype==5">
		      <label >结束时间:</label>
		      <input id="end_time" type="text" placeholder="请选择"  readonly>
	      </div>
	     <div ng-if="timetype==1"  class="checkbox">
	         <label> <input type="checkbox" ng-model="retdata" ng-checked="retdata" style="margin: 0px 0px 0px -20px;">自动查询（10秒查询一次） </label>
	      </div>
	      <button type="button" class="btn btn-info" ng-click="loadData()">查询</button>
	    </div>
	    <div>
	      	<table id="loding" class="table table-bordered">
					<caption  ng-if="timetype==1&&retdata" >
					  <div>
					    <span id="sp_cutttime" >{{cutttime|date:'yyyy-MM-dd HH:mm:ss'}}</span>
					    <span > <span>离下次刷新时间还有：</span> <em id="em_diftime" style="color: red">1</em>秒</span>
					  </div>
					</caption>
					<thead>
						<tr>
							<th>devid</th>
							<th>apid</th>
							<th>温度  </th>
							<th>AU</th>
							<th>BU</th>
							<th>CU</th>
							<th>AI</th>
							<th>BI</th>
							<th>CI</th>
							<th>PWC</th>
							<th>门（1开：0关）            </th>
							<th>电池电压                           </th>
							<th>DEV信号强度    </th>
							<th>AP信号强度 </th>
							<th>数据采集时间 </th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="obj in dataList">
							<td>{{obj.devid}}</td>
							<td>{{obj.datas.apid}}</td>
							<td>{{obj.datas.Temp}}</td>
							<td>{{obj.datas.AU}}</td>
							<td>{{obj.datas.BU}}</td>
							<td>{{obj.datas.CU}}</td>
							<td>{{obj.datas.AI}}</td>
							<td>{{obj.datas.BI}}</td>
							<td>{{obj.datas.CI}}</td>
							<td>{{obj.datas.PWC}}</td>
							<td>{{obj.datas.Switch}}</td>
							<td>{{obj.datas.DU}}</td>
							<td>{{obj.datas.BSI}}</td>
							<td>{{obj.datas.MSI}}</td>
							<td>{{obj.datas.time*1000|date:'yyyy-MM-dd hh:MM:ss'}}</td>
						</tr>
					</tbody>
				</table>
	    </div>
	    
	  
	  </div>
   </div>
   <script type="text/javascript">
	   var app = angular.module('app', []);
	   app.controller('zsdata', function($http, $location,$scope) {
	    $scope.usertype=null;
	    $scope.datatypeMode=[{val:"1",text:"AP设备状态"},{val:"2",text:"DEV设备状态"},{val:"3",text:"DEV数据状态"}];
	    $scope.timetypeMode=[{val:1,text:"近一小时"},{val:2,text:"近3小时"},{val:3,text:"近6小时"},{val:4,text:"近一天"}];
	    $scope.devtypeMode= [{val:"'Temp'",text:"温度"},{"'Switch'":2,text:"门"},{val:"'AU','BU','CU','AI','BI','CI','PWC'",text:"电量"}];
	    function showErrorInfo(msg){var msgEl = $("#mention");if(msg == null || msg == ''){  msgEl.hide();msgEl.html('');}else{msgEl.show();msgEl.html(msg);};}
		 $http({method:'GET',url:'/i/admin/findAdmin'}).success(function(data){admin = data.entity;  if(admin == null || admin.id == 0){ $scope.sid=undefined;}else{ $scope.usertype=admin.role;$scope.sid=admin;window.sessionStorage.devuser=admin;}$("#div_main").show();  }) ;
		 $scope.login=function() {
			          window.sessionStorage.clear();
			          var me = "#submit";
				      if($(me).data('isLoading') === true)return;
					  showErrorInfo("");
					   if ($("#adminname").val() == '') {
							showErrorInfo("用户名不能为空！");
							return;
						} else if ($("#adminpwd").val() == '') {
							showErrorInfo("密码不能为空！");return;
						} 
						$(me).text("登录中...");
						$(me).data('isLoading',true);
						  $http({method:'POST',url:'/i/admin/userlogin',params:{adminName : $("#adminname").val(),adminPwd : $("#adminpwd").val(),sik:new Date().getHours()} }).success(function(data){ 
								$(me).text("登录");$(me).delay(500).data('isLoading',false);
								if (data.success) {
									 $scope.sid=data.entity.token;
									 $scope.usertype=data.entity.user.role;
									 window.sessionStorage.devuser=data.entity.user;
								} else {
									$scope.sid=undefined;
									window.sessionStorage.clear();
									showErrorInfo(data.message);
								}
							})  ;
			};
// 			$scope.datatype=$scope.datatypeMode[0].val;
// 			$scope.timetype=1;
			$("#start_time").jeDate({
			    format:"YYYY-MM-DD hh:mm:ss",
			    minDate: $.nowDate(-1), //0代表今天，-1代表昨天，-2代表前天，以此类推
			    maxDate: $.nowDate(1) //1代表明天，2代表后天，以此类推
			});
			$("#end_time").jeDate({
			    isinitVal:true,
			    skinCell:"jedateblue",
			    minDate:	$.nowDate(0),
			    format: 'YYYY-MM-DD hh:mm:ss'
			});
			if( $scope.usertype==-2||$scope.usertype>=0){$scope.timetypeMode.push({val:5,text:"自定义"});}
			$scope.loadData=function(){
				alert($scope.datatype);
			};
	  });
	  
	  </script>
   </body>
</html>
