<!DOCTYPE html>
<html>
  <head>
    <title>设备数据</title>
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8">
  </head>
  <link rel="shortcut icon" href="assets/img/favicon.ico" />
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
   <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
        <link rel="stylesheet" href="assets/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="assets/css/index.css">
  <script type="text/javascript" src="assets/plugins/jQuery/jQuery-2.1.4.min.js"></script>
  <script type="text/javascript" src="bower_components/angular/angular.min.js"></script>
  <body>
   <div ng-app="app"  ng-controller="zsdata">
	   <div ng-if="sid==null">
			<div class="head">
				<div class="logoArea pull-left" onclick="">
					<h1 class="logo  pull-left"></h1><h3 class="manage  pull-left">设备管理系统</h3>
				</div>
			</div>
    		<div class="content" style="background: #303A44">            
                <div class="panel panel-success">
                   <div class="panel-heading">
                      <h3 class="panel-title">管理员登陆</h3>
                   </div>
                   <div class="panel-body">
                      <div class="main-form-container">
                        <div class="form-group">
                            <input type="text" class="form-control" name="adminname" id="adminname" placeholder='用户名' >
                            <!-- 错误信息 popover -->
                            <div class="err-popover-out">
                                <div class="err-popover">
                                    <div class="tri-right"></div>
                                    <div class="tri-right-in"></div>
                                    <div class="err-popover-content"></div>
                                </div>
                            </div>
                            <!-- 错误信息 popover end -->
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" id="adminpwd" name="adminpwd" placeholder='密码' >
                            <!-- 错误信息 popover -->
                            <div class="err-popover-out">
                                <div class="err-popover">
                                    <div class="tri-right"></div>
                                    <div class="tri-right-in"></div>
                                    <div class="err-popover-content"></div>
                                </div>
                            </div>
                            <!-- 错误信息 popover end -->
                        </div>
                        <button type="button" id="submit" class="btn btn-form-common form-control" ng-click="login();"><span>登录</span></button>
                        <div class="row">
                          <div class="col-xs-8">
                            <a style="color:red" hidden=true id="mention">用户名或密码错误</a>
                          </div>
                        </div>
                   </div>
                </div>
    			<!-- 内容区域结构结束-->
    		</div>
	  </div>
	  <div ng-if="sid!=null">
	    
	  
	  </div>
   </div>
	  <script type="text/javascript">
	  var app = angular.module('app', []); app.controller('zsdata', function($http, $location,$scope) {
		  function showErrorInfo(msg){
				var msgEl = $("#mention");
				if(msg == null || msg == ''){
	                msgEl.hide();
	                msgEl.html('');
				}else{
					msgEl.show();
	    			msgEl.html(msg);
				}
			}
			 scope.login=function() {
			          var me = "#submit";
				        if($(me).data('isLoading') === true)return;
						showErrorInfo("");
						if ($("#adminname").val() == '') {
							showErrorInfo("用户名不能为空！");
							return;
						} else if ($("#adminpwd").val() == '') {
							showErrorInfo("密码不能为空！");return;
						} 
						$(me).text("登录中...");
						$(me).data('isLoading',true);
						$.ajax({
									type : 'POST',
									dataType : "json",
									url : "/i/admin/login",
									data : {adminName : $("#adminname").val(),adminPwd : $("#adminpwd").val(),sik:new Date().getHours()},
									complete : function(e){ $(me).text("登录");$(me).delay(500).data('isLoading',false);},
									success : function(data) {
										if (data.success) {
		                                    document.cookie = data.message;
		                                    window.sessionStorage.asikey=data.message;
		                                    window.location.href = "http://"+ window.location.host + "/main.html#/webSiteVisits";
	                                        return;
										} else {
										    $("#mention")[0].hidden = false;
											showErrorInfo(data.message);
										}
									}
								});
					};
				$(document).on({keyup : function(e) {if (e.keyCode == '13'){login();}}});
				window.sessionStorage.removeItem("asikey");
	 	
	 	
	  });
	  </script>
   </body>
</html>
